# 데이터 수집 및 콘텐츠 생성 엔진

## A. 데이터 수집 및 분석 모듈 (Input)

### 1. 음성 데이터 (STT)
- 수업 중 선생님/학생의 음성 녹음 파일을 텍스트로 변환
- Room ID로 외부 API(`lecture-analysis-pipeline-api.seoltab.com`)에서 STT 데이터 조회
- Gemini AI를 사용하여 STT 오인식, 오타, 화자 판단 오류 보정

### 2. 교재 데이터 (이미지)
- Pagecall API를 통해 Room ID로 업로드된 교재 페이지 이미지 URL 추출
- S3 이미지(`amazonaws.com`) 및 설탑 이미지 서버(`a.seoltab.com`) 지원
- STT에서 언급된 개념 키워드를 추출하여 관련 이미지 자동 매칭 (Gemini Vision API 사용)

### 3. 수업 메타 데이터
- Room ID로 과목, 수업 시간 정보 조회
- Pagecall API를 통해 학생 ID, 학생 이름 추출

---

## B. 콘텐츠 생성 엔진 (Process - LLM)

### Trigger
- 현재: `/admin/lecture-summary` 페이지에서 Room ID 입력 후 수동 생성
- 향후: Pagecall 웹훅을 통한 수업 종료 시 자동 트리거 예정

### Processing

#### 1. 요약 생성
- STT 텍스트 중 핵심 키워드 및 개념 설명 추출
- 학생 이름/별명을 활용한 개인화된 요약 생성
- 유은서 쌤 페르소나 적용 (친근한 반말, 격려 톤)
- 수업 내용을 시간 순서대로 상세 정리

#### 2. 취약점 탐지 (Key Logic)
- 학생의 발화 중 머뭇거림(침묵 구간), 오답 키워드, "모르겠어요" 등의 패턴 감지
- 선생님 질문 → 학생 불확실 응답 패턴 분석
  - 질문 패턴: "?", "어떻게", "뭐야", "알지", "기억나", "뭐지"
  - 불확실 응답: "음", "어", "모르", "잘 모르", 짧은 응답(5자 미만), "틀렸", "헷갈"
- 해당 구간의 교재 내용과 매칭하여 "아까 놓친 부분" 섹션에 포함

#### 3. 강조 포인트 추출
- 선생님의 반복 어휘, "중요해", "시험에 나와" 등의 키워드가 포함된 구간 태깅
- 프롬프트에 강조 포인트 지시 포함 (예: "아까 쌤이 [핵심 개념] 설명할 때 목소리 엄청 커지셨지? 시험에 무조건 나온대.")
- ⚠️ 음성 볼륨 정보는 현재 STT 데이터에 없어 활용 불가 (향후 개선 예정)

---

## 데이터 흐름

```
Room ID 입력
    ↓
병렬 데이터 수집
  - Room 메타데이터 (과목, 시간)
  - STT 데이터 (대화 내용)
  - 이미지 URL 목록
  - 학생 정보
    ↓
STT 보정 (Gemini AI)
  - 오인식 수정
  - 화자 판단 보정
    ↓
취약점 탐지
  - 선생님 질문 → 학생 불확실 응답 패턴 분석
    ↓
이미지 관련성 분석 (Gemini Vision)
  - STT 키워드 추출
  - 이미지별 관련성 점수 계산
  - 점수 40 이상 이미지 선택
    ↓
요약 생성 (Gemini AI)
  - 개인화된 요약
  - 놓친 부분 포함
  - 교재 이미지 활용
    ↓
MongoDB 저장 (ReviewProgram)
    ↓
요약본 완성
```
